<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>减肥论坛 · 隐藏版（论坛解谜版）</title>
<style>
:root {
  --bg: #f4f4f4;
  --text: #222;
  --card: #fff;
  --border: #ccc;
}
body.dark {
  --bg: #1b1b1b;
  --text: #e6e6e6;
  --card: #2b2b2b;
  --border: #555;
}
body {
  background: var(--bg);
  color: var(--text);
  font-family: "Microsoft YaHei", sans-serif;
  transition: background 0.4s, color 0.4s;
  padding: 20px;
}
#container {
  width: 800px;
  margin: auto;
}
header {
  margin-bottom: 20px;
  text-align: center;
}
#themeBtn {
  margin-left: 10px;
}
forum-section, .forum-section {
  /* placeholder */
}
.post-list, .post-view {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 20px;
}
.post-item {
  padding: 10px;
  border-bottom: 1px solid var(--border);
  cursor: pointer;
}
.post-item:last-child { border-bottom: none; }
.post-item:hover { background: rgba(0,0,0,0.03); }
.post-title { font-size: 1.2em; margin: 0; }
.post-meta { font-size: 0.9em; color: #666; }
.reply-section {
  margin-top: 20px;
  padding-top: 10px;
  border-top: 1px solid var(--border);
}
.reply-item {
  padding: 8px;
  border-bottom: 1px solid var(--border);
}
.reply-item:last-child { border-bottom: none; }
#newReply {
  margin-top: 15px;
}
#notes { background: var(--card); border:1px solid var(--border); border-radius:8px; padding:10px; max-height:150px; overflow-y:auto; }

</style>
</head>
<body>
<div id="container">
  <header>
    <h1>🏃‍♀️ 减肥论坛 · 隐藏版</h1>
    <button id="themeBtn">切换主题</button>
  </header>

  <div id="notesSection">
    <h3>📝 玩家笔记</h3>
    <div id="notes">(暂无记录)</div>
  </div>

  <div id="forumInterface">
    <div id="postList" class="post-list"></div>
    <div id="postView" class="post-view hidden"></div>
  </div>
</div>

<script>
// ========== 数据结构 ==========
const posts = [
  {
    id: 1,
    title: "【隐藏子论坛】分割与献祭——极致减肥法",
    author: "资深帖友A",
    content: "内容已隐藏，输入密码查看。",
    replies: []
  },
  {
    id: 2,
    title: "季度聚会 · 新人报告贴",
    author: "资深帖友B",
    content: "每次聚会新人的情况如何……← 留待解锁",
    replies: []
  },
  {
    id: 3,
    title: "普通贴：我的卡路里控制经验",
    author: "普通会员C",
    content: "大家好，这是我最近一周的热量记录…",
    replies: [
      {author:"会员D", text:"不错，坚持下去！"},
      {author:"会员E", text:"请问怎么控制晚餐？"}
    ]
  }
];

let notes = [];
function updateNotes(){
  const nDiv = document.getElementById("notes");
  if(notes.length === 0) {
    nDiv.innerHTML = "(暂无记录)";
  } else {
    nDiv.innerHTML = notes.map(w=>`📌 ${w}`).join("<br>");
  }
}

function addNote(kw){
  if(!notes.includes(kw)){
    notes.push(kw);
    updateNotes();
  }
}

// ========== 渲染帖子列表 ==========
function renderPostList(){
  const listDiv = document.getElementById("postList");
  listDiv.innerHTML = "";
  posts.forEach(p=>{
    const div = document.createElement("div");
    div.className = "post-item";
    div.innerHTML = `<p class="post-title">${p.title}</p><p class="post-meta">作者：${p.author}</p>`;
    div.onclick = ()=>viewPost(p.id);
    listDiv.appendChild(div);
  });
}

// ========== 查看单个帖子 ==========
function viewPost(id){
  const post = posts.find(p=>p.id===id);
  const viewDiv = document.getElementById("postView");
  viewDiv.classList.remove("hidden");
  viewDiv.innerHTML = `
    <h2>${post.title}</h2>
    <p>作者：${post.author}</p>
    <div>${post.content}</div>
    <div class="reply-section">
      <h4>回复：</h4>
      <div id="replies">${post.replies.map(r=>`<div class="reply-item"><strong>${r.author}：</strong>${r.text}</div>`).join("")}</div>
      <textarea id="replyText" rows="2" placeholder="输入回复..."></textarea><br>
      <button onclick="submitReply(${post.id})">发表回复</button>
      <button onclick="backToList()">返回列表</button>
    </div>
  `;
}

// ========== 提交回复 ==========
function submitReply(postId){
  const txt = document.getElementById("replyText").value.trim();
  if(txt==="") return alert("请输入内容");
  const post = posts.find(p=>p.id===postId);
  post.replies.push({author:"你", text:txt});
  // 加入笔记：记录关键词“回复”
  addNote("回复帖："+post.title);
  viewPost(postId);
}

// ========== 返回列表 ==========
function backToList(){
  document.getElementById("postView").classList.add("hidden");
}

// ========== 密码解锁机制 ==========
function unlockPost(id){
  const post = posts.find(p=>p.id===id);
  const pwd = prompt("请输入密码查看该帖：");
  if(pwd==="cut2025"){
    post.content = "【解锁内容】每季度聚会一次，地点在郊区牧场。新人往往在此获得真正的“减重启示”。";
    updateNotes();
    renderPostList();
    viewPost(id);
  } else {
    alert("密码错误！");
  }
}

// ========== 初始化 ==========
renderPostList();
updateNotes();

// 增加交互：点击隐藏帖时先密码验证
document.querySelectorAll(".post-item").forEach(div=>{
  // we can't bind easily here; instead: override viewPost to check
});

// 改进：在 viewPost 判断如果内容为“内容已隐藏”，提示解锁
const originalViewPost = viewPost;
viewPost = function(id){
  const post = posts.find(p=>p.id===id);
  if(post.content==="内容已隐藏，输入密码查看。"){
    unlockPost(id);
  } else {
    originalViewPost(id);
  }
};

// 主题切换
document.getElementById("themeBtn").onclick = ()=>{
  document.body.classList.toggle("dark");
};

</script>
</body>
</html>
